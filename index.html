<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name = "format-detection" content = "telephone=no"/>
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
  <link rel="stylesheet" href="css/jquery.mobile-1.4.5.css">
  <link rel="stylesheet" type="text/css" href="css/index.css" />
  <!--script type="text/javascript" src="cordova.js"></script-->
  <title>Weighting System</title>

  <script src="js/jquery.js"></script>
  <!--script src="../_assets/js/index.js"></script-->

  <script>
    // Bind to "mobileinit" before you load jquery.mobile.js
    // Set the default transition to slide
    $(document).on( "mobileinit", function()
    {
      //$.mobile.defaultPageTransition = "slide";
      $.mobile.listview.prototype.options.headerTheme = "b";
    });

    pollTimer = 0;
  </script>

  <script src="js/jquery.mobile-1.4.5.js"></script>

  <script>
    $(function()
    {
      $(document).pagecontainer({defaults: true});
      $("[data-role=header]").toolbar(); /* initialize header */

      // Navigate to next page when the "next" button is clicked
      $(".control .next").on("click", function()
      {
        console.log("nextbtn, "+ prev + " <> " + next);
        $("body").pagecontainer("change", next);
      });
      $(".control .prev").on("click", function()
      {
        console.log("prevbtn, "+ prev + " <> " + next);
        $("body").pagecontainer("change", prev, {reverse: true});
      });
    });

    //$(document).on("pagecontainerchange", function( event, ui )
    $(document).on("pagecontainerbeforetransition", function( event, ui )
    {
      // Get the references to the prev and next page that we stored in the data-next attribute
      //next = $("body").pagecontainer("getActivePage").jqmData("next");
      //prev = $("body").pagecontainer("getActivePage").jqmData("prev");
      next = ui.toPage.jqmData("next");
      prev = ui.toPage.jqmData("prev");

      console.log("pagecontainerchange, "+ prev + " <> " + next);
      if(next)
        $(".control .next").removeClass("ui-disabled");
      else
        $(".control .next").addClass("ui-disabled");

      if(prev)
        $(".control .prev").removeClass("ui-disabled");
      else
        $(".control .prev").addClass("ui-disabled");
    });

    // Navigate to next page on swipe left
    $(document).on("swipeleft", $(document), function()
    {
      if(next)
      {
        console.log("swipe, "+ prev + " <> " + next);
        $("body").pagecontainer("change", next);
      }
    });
    $(document).on("swiperight", $(document), function()
    {
      if(prev)
      {
        console.log("swipe, "+ prev + " <> " + next);
        $("body").pagecontainer("change", prev, {reverse: true});
      }
    });

    // Take over the device back button
    $(window).on("navigate", function (event, data)
    {
      var direction = data.state.direction;
      if (direction == 'back')
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "content")
        {
          app.disconnect(true);
          navigator.app.exitApp();	// Android only
        }
        else
          $("body").pagecontainer("change", "#content", {transition:"fade"});
      }
      return(false);
    });

    $.fn.redraw = function()
    {
      return $(this).each(function()
      {
        var redraw = this.offsetHeight;
      });
    };
  </script>

  <script type="text/javascript" src="cordova.js"></script>
  <script type="text/javascript" src="js/index.js"></script>

  <style>
    /* Prevent text selection while swiping with mouse */
    //.ui-header, .ui-title, .control .ui-btn, .trivia-btn {
    .ui-header, .ui-title, .trivia-btn {
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		-o-user-select: none;
		user-select: none;
	}
  </style>
  <!--style type="text/css">
    .progress-bar input[type=number], .ui-slider-handle {
      display: none;
    }
    .progress-bar .ui-slider-track {
      margin: 0px;
    }
  </style-->
</head>
<body style="background-color: #252525;">


<div data-role="header" style="overflow:hidden;" class="ui-page-theme-b" data-position="fixed" data-tap-toggle="false">
  <h1>Weighting System</h1>
  <div data-role="controlgroup" class="control ui-btn-right" data-type="horizontal" data-mini="true">
    <a id="connectIcon" href="#bluetooth" data-role="button" data-icon="check" data-iconpos="notext" class="ui-state-disabled">Bluetooth</a>
    <!--a href="#" data-role="button" data-icon="gear">Options</a-->
  </div>
  <div data-role="controlgroup" class="control ui-btn-left" data-type="horizontal" data-mini="true">
    <a href="#" class="prev" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-theme="d">Previous</a>
    <a href="#" class="next" data-role="button" data-icon="arrow-r" data-iconpos="notext" data-theme="d">Next</a>
  </div>
</div><!-- /header -->



<!--div data-role="page" id="content" data-prev="#bluetooth" data-next="#values" class="ui-page-theme-b"-->
<div data-role="page" id="content" data-prev="#bluetooth" data-next="#calibration" class="ui-page-theme-b">

  <div id="weight" class="ui-body ui-body ui-corner-all">
    <span id="weightdisplay" class="weight">---</span>
  </div>

  <div data-role="footer" data-position="fixed" data-tap-toggle="false">
    <div class="statusMessage"></div>
   <!--
    <div class="progress-bar">
	  <input type="range" id="weightprogress" value="0" min="0" max="1" step="0.01" data-highlight="true" />
    </div>
    <div data-role="controlgroup" data-type="horizontal">
	  <a href="#" class="ui-btn">Button 1</a>
	  <a href="#" class="ui-btn">Button 2</a>
	  <a href="#" class="ui-btn">Button 3</a>
    </div>
    -->
    <table id="indicators"><tbody><tr>
      <td class="indicator ind_red" id="ind_red">&nbsp;</td>
      <td class="indicator ind_yellow" id="ind_yellow">&nbsp;</td>
      <td class="indicator ind_green" id="ind_green">&nbsp;</td>
    </tr></tbody></table>
  </div>

  <script>
    $(document).ready(function()
    {
      $.fn.textfill = function(options)
      {
        var fontSize = options.maxFontPixels;
        var ourText = $('#weightdisplay', this);
        var maxHeight = $(this).parent().height();
        var maxWidth = $(this).parent().width();
        var textHeight;
        var textWidth;

        textHeight = ourText.outerHeight();
        textWidth = ourText.outerWidth();

        var tmp = ourText.html();
        if(tmp.length < 6)
        {
          ourText.html('0000KG');
          //app.setStatus("set size");
          ourText.redraw();
        }

        ourText.css('font-size', 50);
        ourText.css('marginTop', '');
        ourText.css('display', 'none');

        do
        {
          ourText.css('font-size', fontSize);
          do
          {
            textHeight = ourText.outerHeight();
          } while(textHeight == 0);

        	//console.log(textHeight);
          textWidth = ourText.outerWidth();
          fontSize -= 1;
        } while((textHeight > maxHeight || textWidth > maxWidth) && (fontSize > 50));

        //console.log(maxHeight + ", " + textHeight + " - " + maxWidth + ", " + textWidth);
        if(maxHeight - textHeight > 0)
        {
          // adjust vertical position
          ourText.css('marginTop', (maxHeight - textHeight) / 2);
        }

        ourText.html(tmp);
        ourText.css('display', 'inline-block');
        return this;
      }

      window.setTimeout(function(){$("div#weight").textfill({ maxFontPixels: 500 });}, 150);

      $(window).on("orientationchange", function()
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "content")
        {
          $('#weightdisplay').css('font-size', 50);
          $('#weightdisplay').css('marginTop', '');
          $('#weightdisplay').css('display', 'none');

          window.setTimeout(function(){$("div#weight").textfill({ maxFontPixels: 500 });}, 150);
        }
      });

      $(document).on("pagecontainerchange", function( event, ui )
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "content")
        {
          window.setTimeout(function(){$("div#weight").textfill({ maxFontPixels: 500 });}, 150);
        }
      });

      $("div#weight").on("updatelayout", function( event, ui )
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "content")
        {
          window.setTimeout(function(){$("div#weight").textfill({ maxFontPixels: 500 });}, 150);
        }
      });

    });

    mainValue = function(args)
    {
      if(args === undefined)
        var args = ["---", "0"];

      if(lastValue == args)
        return;
      lastValue = args;

      $('.weight').html("<nobr>" + args[0] + "</nobr>");
      //$('#weightprogress').val(args[0]);

      if(indicators)
      {
        args[1] = parseInt(args[1]);

        $('td.ind_red').css('background', args[1] & 0x01 ? "red" : "#330000");
        $('.ind_red').css('color', args[1] & 0x01 ? "red" : "#330000");
        $('td.ind_red').html(args[1]);

        $('td.ind_yellow').css('background', args[1] & 0x02 ? "yellow" : "#333300");
        $('.ind_yellow').css('color', args[1] & 0x02 ? "yellow" : "#333300");
        $('td.ind_yellow').html(args[1]);

        $('td.ind_green').css('background', args[1] & 0x04 ? "lime" : "#003300");
        $('.ind_green').css('color', args[1] & 0x04 ? "lime" : "#003300");
        $('td.ind_green').html(args[1]);
      }
    }
    lastValue = ["",""];

  </script>

  <script type="text/javascript">
    $(document).ready(function()
    {
      window.setInterval(function () {app.pollWeight()}, 1000);
    });
  </script>
</div>



<div data-role="page" id="bluetooth" data-next="#content" class="ui-page-theme-b">
  <fieldset data-role="controlgroup">
    <label for="deviceList">Device:</label>
    <select name="deviceList "id="deviceList">
      <option value="0">...</option>
    </select>
  </fieldset>
  <fieldset data-role="controlgroup">
    <a href="#" id="connectButton" data-role="button" class="ui-state-disabled">Connect</a>
    <a href="#" id="disconnectBtn" data-role="button" class="ui-state-disabled">Disconnect</a>
    <a href="#" id="listButton" data-role="button">List Devices</a>
  </fieldset>
  <fieldset data-role="controlgroup">
    <a href="#" id="connectQrButton" data-role="button">Connect with QR code</a>
  </fieldset>

  <div data-role="footer" data-position="fixed" data-tap-toggle="false">
    <div class="statusMessage"></div>
  </div>

  <script type="text/javascript">
    $(document).ready(function()
    {
      $(document).on("pagecontainerchange", function( event, ui )
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "bluetooth")
        {
        }
      });
    });
  </script>

</div>



<!--div data-role="page" id="values" data-prev="#content" data-next="#calibration" class="ui-page-theme-b"-->
<div data-role="page" id="values" data-prev="#calibration" data-next="#about" class="ui-page-theme-b">
  <table data-role="table" id="debug-data" data-mode="reflow2" class="ui-responsive">
    <thead><tr>
      <th>Weight</th><th class="weight">---</th><th class="ind_green">&check;</th>
        <th class="ind_yellow">&excl;</th><th class="ind_red">&cross;</th>
    </tr><tr>
      <th>Node</th><th>Vect</th><th>Gain</th><th>Zero</th><th>Angle</th>
    </tr></thead>
    <tbody>
      <tr id="node1"><th>Center</th><td>x</td><td>x</td><td>x</td><td>0</td></tr>
      <tr id="node2"><th>Front Right</th><td>x</td><td>x</td><td>x</td><td>0</td></tr>
      <tr id="node3"><th>Front Left</th><td>x</td><td>x</td><td>x</td><td>0</td></tr>
      <tr id="node4"><th>Rear Right</th><td>x</td><td>x</td><td>x</td><td>0</td></tr>
      <tr id="node5"><th>Rear Left</th><td>x</td><td>x</td><td>x</td><td>0</td></tr>
    </tbody>
  </table>

  <fieldset data-role="controlgroup">
    <input type="button" value="$CAL?" onclick="app.sendDataRaw(this.value);"/>
    <input type="button" value="$ANG?" onclick="app.sendDataRaw(this.value);"/>
  </fieldset>

  <div data-role="footer" data-position="fixed" data-tap-toggle="false">
    <textarea id="debugmessages" rows="6" readonly="readonly" style="overflow-y:auto;"></textarea>
    <div class="statusMessage"></div>
  </div>

  <script type="text/javascript">
    $(document).ready(function()
    {
      $(document).on("pagecontainerchange", function( event, ui )
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "values")
        {
          var pollCfg = function()
          {
            //console.log("pollstate " + pollState);
            if(pollState <= 5)
            {
              app.sendDataRaw("$CFG?" + pollState);
              pollState++;
              pollTimer = window.setTimeout(pollCfg, 100);
            }
            else
            {
              app.sendDataRaw("$ANG?");
              pollTimer = window.setTimeout(pollCfg, 500);
            }
          };

          pollState = 1;
          pollTimer = window.setTimeout(pollCfg, 100);
          debugmessages.scrollTop = debugmessages.scrollHeight;
        }
        else
        {
          window.clearTimeout(pollTimer);
        }
      });
    });

    valuesConfig = function(args)
    {
      if(args === undefined)
      {
        valuesConfig([1,'-','','0','0']);
        valuesConfig([2,'-','','0','0']);
        valuesConfig([3,'-','','0','0']);
        valuesConfig([4,'-','','0','0']);
        valuesConfig([5,'-','','0','0']);
        return;
      }

      var cols = $("#node" + args[0]).find('td').get();
      cols[0].innerHTML = args[1];
      cols[1].innerHTML = args[2] * args[3];
      cols[2].innerHTML = args[4];
      cols[3].innerHTML = "?";

    //  args[0] = parseInt(args[0]);
    //  if(args[0] < 5)
    //  {
    //    var text = "$CFG?" + (args[0] + 1) + "\n";
    //    bluetoothSerial.write(text);
    //  }
    }
    //var a = [3, 2, -1, 3, 4];
    //valuesConfig(a);

    valuesAngles = function(args)
    {
      if(args === undefined)
      {
        var args = [0,0,0,0,0];
      }

      $("#node1").find('td').get()[3].innerHTML = args[0] / 100;
	  $("#node2").find('td').get()[3].innerHTML = args[1] / 100;
	  $("#node3").find('td').get()[3].innerHTML = args[2] / 100;
	  $("#node4").find('td').get()[3].innerHTML = args[3] / 100;
	  $("#node5").find('td').get()[3].innerHTML = args[4] / 100;
	}


  </script>

</div>



<!--div data-role="page" id="calibration" data-prev="#values" data-next="#about" class="ui-page-theme-b"-->
<div data-role="page" id="calibration" data-prev="#content" data-next="#values" class="ui-page-theme-b">
  <form>
	<fieldset data-role="controlgroup">
      <legend>Front suspension axis:</legend>
      <select name="front-susp" id="front-susp" onchange="app.sendDataRaw('$CAL=1,' + this[this.selectedIndex].value);">
        <option value="0" selected disabled>...</option>
        <option value="1">Perpendicular (independent)</option>
        <option value="2">Longitudinal</option>
      </select>
    </fieldset>

  <div data-role="controlgroup" class="control ui-btn-right" data-type="horizontal" data-mini="true">
  </div>
	<fieldset data-role="controlgroup">
      <legend onclick="">Central Module mounting:</legend>
      <select name="cpu-mount" id="cpu-mount" onchange="app.sendDataRaw('$CAL=0,' + this[this.selectedIndex].value);">
        <option value="0" selected disabled>...</option>
        <option value="1">Short side longitudal, BT icon towards front</option>
        <option value="2">Short side longitudal, BT icon towards rear</option>
        <option value="3">Connections side to front</option>
        <option value="4">Connections side to rear</option>
        <option value="5">Label side to front</option>
        <option value="6">Label side to rear</option>
      </select>
     </fieldset>

    <fieldset data-role="controlgroup">
      <div data-role="collapsible">
        <legend>Reference Weight:</legend>

        <p>Distances are relative to a fixed point <u>behind</u> the vehicle, a wall for example. The measurements
          are intented to be in centimeters, however, inches or millimeters work equally well since the units are
          cancelled out once the relative position has been determined.</p>

        <div data-role="rangeslider" id="dist-axis-slider">
          <label for="dist-rear-slider">Distance to rear and front axles:</label>
          <input type="range" name="dist-rear-slider" id="dist-rear-slider" data-highlight="true" min="0" max="1000" value="250" step="1"/>
          <label for="dist-front-slider">Distance to rear and front axles:</label>
          <input type="range" name="dist-front-slider" id="dist-front-slider" data-highlight="true" min="0" max="1000" value="750" step="1" />
        </div>

        <div data-role="rangeslider" id="dist-ref-slider">
          <label for="dist-rear-slider2">Distance to center of gravity of the reference weight:</label>
          <input type="range" name="dist-rear-slider" id="dist-rear-slider2" data-highlight="true" min="0" max="1000" value="250" step="1"/>
          <label for="dist-ref-slider">Distance to center of gravity of the reference weight</label>
          <input type="range" name="dist-ref-slider" id="dist-ref-slider2" data-highlight="true" min="0" max="1000" value="400" step="1"/>
        </div>

        <label for="rel-ref-slider">Relative position (%)</label>
        <input type="range" name="rel-ref-slider" id="rel-ref-slider" data-highlight="true" min="0.0" max="100.0" value="0" step="0.1"/>

        <label for"reference-slider">Reference weight (kg)</label>
        <input type="range" name="reference-slider" id="reference-slider" data-highlight="true" min="0" max="1000" value="500" step="100"/>

      </div>
    </fieldset>

    <input type="button" id="calibrateZero" value="Calibrate zero load" onclick="app.sendDataRaw('$CAL=2');"/>
    <input type="button" id="calibrateReference" value="Calibrate reference load" class="ui-state-disabled" onclick="app.sendDataRaw('$CAL=4,' + 100 * parseFloat($('#rel-ref-slider').val()));"/>

    <fieldset data-role="controlgroup">
      <legend>Limit Weight (kg):</legend>
      <input type="range" name="limit-slider" id="limit-slider" data-highlight="true" min="0" max="2500" value="500" step="100" onchange="app.sendDataRaw('$MAX=' + $(this).val());"/>
    </fieldset>

    <fieldset data-role="controlgroup">
      <input type="text" name="cal-rsp" id="cal-rsp" value="" readonly="true" onclick="app.sendDataRaw('$CAL?');"/>
    </fieldset>
  </form>

  <script type="text/javascript">
    pollCalibrationTimer = "";
    prevRefPos = 0;

    calcRatio = function(front, rear, ref)
    {
      var pos = 100 * (ref-rear) / (front - rear);

      $('#rel-ref-slider').val(pos);
      $('#rel-ref-slider').slider('refresh');

      window.localStorage.setItem("reference_front", front);
      window.localStorage.setItem("reference_rear", rear);
      window.localStorage.setItem("reference_ref", ref);
    }

    changeAxisSlider = function()
    {
      var axis = [];

      axis[0] = $('#dist-rear-slider').val();
      axis[1] = $('#dist-front-slider').val();

      axis[2] = $('#dist-rear-slider2').val();
      axis[3] = $('#dist-ref-slider2').val();

      if(axis[0] != axis[2])
      {
        $('#dist-rear-slider2').val(axis[0]);
        $('#dist-ref-slider').rangeslider('refresh');
      }

      if(axis[1] < axis[3])
      {
        $('#dist-ref-slider2').val(axis[1]);
        $('#dist-ref-slider').rangeslider('refresh');
      }

      calcRatio(axis[1], axis[0], axis[3]);
    }

    changeRefSlider = function()
    {
      var axis = [];

      axis[0] = $('#dist-rear-slider').val();
      axis[1] = $('#dist-front-slider').val();

      axis[2] = $('#dist-rear-slider2').val();
      axis[3] = $('#dist-ref-slider2').val();

      if(axis[0] != axis[2])
      {
        $('#dist-rear-slider2').val(axis[0]);
        $('#dist-ref-slider').rangeslider('refresh');
      }

      if(axis[1] < axis[3])
      {
        $('#dist-ref-slider2').val(axis[1]);
        $('#dist-ref-slider').rangeslider('refresh');
      }

      calcRatio(axis[1], axis[0], axis[3]);
    }

    changeReferenceWeight = function()
    {
      app.sendDataRaw('#CAL=3,' + $('#reference-slider').val());
    }

    $(document).ready(function()
    {
      $('#dist-axis-slider').on("change", changeAxisSlider);
      $('#dist-ref-slider').on("change", changeRefSlider);
      $('#reference-slider').on("change", changeReferenceWeight);

      $(document).on("pagecontainerchange", function( event, ui )
      {
        if($("body").pagecontainer("getActivePage").attr('id') == "calibration")
        {
          var axis = [];
          axis[1] = window.localStorage.getItem("reference_front");
          axis[0] = window.localStorage.getItem("reference_rear");
          axis[3] = window.localStorage.getItem("reference_ref");

          if(axis[1] == 0) axis[1] = 750;
          if(axis[0] == 0) axis[0] = 250;
          if(axis[3] == 0) axis[3] = 500;

          $('#dist-front-slider').val(axis[1]);

          $('#dist-rear-slider').val(axis[0]);
          $('#dist-rear-slider2').val(axis[0]);

          $('#dist-ref-slider2').val(axis[3]);

          $('#dist-axis-slider').rangeslider('refresh');
          $('#dist-ref-slider').rangeslider('refresh');

          calcRatio(axis[1], axis[0], axis[3]);

          var pollCalibration = function()
          {
            //console.log("pollstate " + pollState);
            if(pollState == 1)
            {
              app.sendDataRaw("$CAL?");
              pollState++;
              pollCalibrationTimer = window.setTimeout(pollCalibration, 100);
            }
            else
            {
              app.sendDataRaw("$MAX?");
              //pollCalibrationTimer = window.setTimeout(pollCalibration, 500);
            }
          };

          pollState = 1;
          pollCalibrationTimer = window.setTimeout(pollCalibration, 100);
        }
        else
        {
          window.clearTimeout(pollCalibrationTimer);
        }
      });

      calibrationMax = function(args)
      {
        if(args === undefined)
          return;

        // Set maximum weight slider to actual value
        $('#limit-slider').val(args[0]).slider('refresh');
      }

      calibrationStatus = function(args)
      {
        if(args === undefined)
        {
          var args = [0,0,500,,0];
          $('#cal-rsp').val("");
        }
        else
        {
          $('#cal-rsp').val("Cal status: " + args);
        }

        // Cal state report : @CAL=a,b,c,d,e
        // a = alignment of CPU module
        // b = alignment of front axis
        // c = reference weight
        // d = reference position
        // e = calibration completed.

        if((args[0] != '0') && (parseInt(args[4], 16) >= 1))
          app.enable(calibrateReference);
        else
          app.disable(calibrateReference);

        // Alignment of CPU mounting
        $('#cpu-mount').val(args[0]).selectmenu('refresh',true);
        //$('#cpu-mount').selectmenu('refresh');

        if(args[2] == 0)
          app.sendDataRaw('$CAL=3,500');

        $('#reference-slider').val(args[2]);
        $('#reference-slider').slider('refresh');

        var pos = parseFloat(args[3]) / 100;
        if((pos > 0) && (pos != prevRefPos))
        {
          $('#rel-ref-slider').val(parseFloat(args[3]) / 100);
          $('#rel-ref-slider').slider('refresh');
          prevRefPos = pos;
        }

        // Alignment of front suspension
        $('#front-susp').val(args[1]).selectmenu('refresh',true);
        //$('#front-susp').selectmenu('refresh');
      }

      calibrationConfig = function(args)
      {
      }

      // subscribe to @CAL, @CFG, @MAX

    });

  </script>

  <div data-role="footer" data-position="fixed" data-tap-toggle="false">
    <div class="statusMessage"></div>
  </div>
</div>

<!--div data-role="page" id="about" data-prev="#calibration" class="ui-page-theme-b"-->
<div data-role="page" id="about" data-prev="#values" class="ui-page-theme-b">
  <div id="logo" class="dezaag_logo"><p>van De Zaag</p></div>
  <div>
    <p>van De Zaag groep</p>
    <p>voertuigelektronica</p>
    <p>Postbus 7239</p>
    <p>3280 AA Numansdorp</p>
  </div>

  <img src="images\Zaag_GR_Animatie.gif" align="right" style="max-height='50%';"/>


  <div data-role="footer" data-position="fixed" data-tap-toggle="false">
    <div class="statusMessage"></div>
  </div>
</div>


<!--script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script-->
<script type="text/javascript">
  app.initialize();
</script>

</body>
</html>
